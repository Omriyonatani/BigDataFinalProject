
<div class="col-lg-6 col-md-12">
  <div class="card">
    <div class="card-header card-header-warning">
      <h4 class="card-title">Call Topics</h4>
      <!-- <p class="card-category">New employees on 15th September, 2016</p> -->
    </div>
    <script src="/socket.io/socket.io.js"></script>
  <script>
    var socket = io.connect();
  </script>
    <div class="card-body table-responsive">
      <div style="height: 400px; overflow-y: scroll ">
      <table id="topics" class="table table-hover">
        <thead class="text-warning">
          <th>Time</th>
          <th>Waiting Calls</th>
          <th>Waiting Time</th>
          <!-- <th>Service</th>
          <th>Report</th> -->
        </thead>
        <tbody id="callDetails">
          
        </tbody>
        <script>
          function getTimeRanges(interval, language = window.navigator.language) {
            const ranges = [];
            const date = new Date();
            const format = {
              hour: 'numeric',
              minute: 'numeric',
            };

            for (let minutes = 0; minutes < 24 * 60; minutes = minutes + interval) {
              date.setHours(0);
              date.setMinutes(minutes);
              ranges.push(date.toLocaleTimeString(language, format));
            }

            return ranges;
          }
          var timeIs = getTimeRanges(5, 'ru');
          var today = new Date();
          var TimeInMin = (parseInt(today.getHours()) * 60) + parseInt(today.getMinutes());
          for (let index = 0; index < timeIs.length; index++) {
            
            var labelsInMin = (parseInt(timeIs[index].split(":")[0]) * 60) + parseInt(timeIs[index].split(":")[1]);
           
            if (TimeInMin > labelsInMin) {
              var tr= document.getElementById("callDetails").insertRow();
              var cTime= tr.insertCell(0);
              var cWaitingCalls = tr.insertCell(1);
              var cWaitingTimen = tr.insertCell(2);
               
              // var cService = tr.insertCell(3);
              // var cReport = tr.insertCell(4);
              cTime.innerHTML = `<tr><td>${timeIs[index]}</td>`;         
              cWaitingCalls.innerHTML = `<td>${1}</td>`;
              cWaitingTimen.innerHTML = `<td>${2}</td></tr>`
           
             
              
              // cService.innerHTML = `<td>${4}</td>`
              // cReport.innerHTML = `<td>${5}</td></tr>`
            }
         }
         getWaitingClls()
        async function getWaitingClls(){
          return new Promise (res=>{
            
            io.on("totalWaitingCalls", (msg)=> {
              alert(msg.value)
              res(msg.value);
            });
          });      
         }
        async function getWaitingTime(){
          return new Promise (res=>{
            socket.on("waiting time", (msg)=> {
              res(msg.value);
            });
          });      
         }
        </script>
      </table>
    </div>
    </div>
  </div>
</div>